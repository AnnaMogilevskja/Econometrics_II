knitr::opts_chunk$set(echo = TRUE)
library(plm)
library(SciViews)
library(stargazer)
library(magrittr)
library(dplyr)
library(fixest)
library(aod)
library(lmtest)
# Load data
data <- read.csv("assignment2.csv")
lnearnings <- ln(data$earnings)
data <- cbind(data, lnearnings)
pooled1 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw, model = "pooling", data=data)
pooled2 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "pooling", data=data)
stargazer(pooled1, pooled2)
# pooled3 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "pooling", data=data)
pooled4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack * school + urban + regne + regnc + regw + asvabc, model = "pooling", data=data)
stargazer(pooled4)
# random1 <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw + regs, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random3 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
stargazer(random4)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
stargazer(fixed4)
phtest(fixed4, random4)
data <- data %>%
group_by(id) %>%
mutate(mean_school = mean(school),
mean_age = mean(age),
mean_agesq = mean(agesq),
mean_asvabc = mean(asvabc),
mean_urban = mean(urban),
mean_regne = mean(regne),
mean_regnc = mean(regnc),
mean_regw = mean(regw))
mundlak1 <- plm(lnearnings ~ school + age + agesq + mean_school+ mean_age + mean_agesq + mean_urban + mean_regne + mean_regnc + mean_regw, model = "pooling", index = c("id"), effect = "individual", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), effect = "individual", data=datafull)
summary(mundlak1)
mundlak2 <- plm(lnearnings ~ school + age + agesq + mean_school+ mean_age + mean_agesq + mean_urban + mean_regne + mean_regnc + mean_regw, model = "pooling", index = c("id"), effect = "individual", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), effect = "individual", data=datafull)
summary(mundlak1)
View(mundlak2)
View(mundlak1)
View(mundlak2)
View(mundlak1)
View(mundlak2)
View(mundlak1)
View(mundlak2)
summary(mundlak1)
summary(mundlak2)
mundlak2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + mean_urban + mean_regne + mean_regnc + mean_regw, model = "pooling", index = c("id"), effect = "individual", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), effect = "individual", data=datafull)
summary(mundlak1)
summary(mundlak1)
summary(mundlak2)
mundlak2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + mean_urban + mean_regne + mean_regnc + mean_regw, model = "pooling", index = c("id"), data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), effect = "individual", data=datafull)
summary(mundlak1)
summary(mundlak1)
summary(mundlak2)
knitr::opts_chunk$set(echo = TRUE)
library(plm)
library(SciViews)
library(stargazer)
library(magrittr)
library(dplyr)
library(fixest)
library(aod)
library(lmtest)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + ethblack*mean_school mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), data=data)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + ethblack*mean_school + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), data=data)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + ethblack*mean_school + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = "id", data=data)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school) + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = "id", data=data)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school), model = "random", index = "id", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + ethblack*mean_school mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), effect = "individual", data=datafull)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school), model = "random", index = "id", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school) + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), effect = "individual", data=datafull)
summary(mundlak1)
summary(mundlak1)
summary(mundlak2)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school), model = "random", index = "id", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school), model = "random", index = c("id"), effect = "individual", data=datafull)
summary(mundlak1)
summary(mundlak2)
install.packages("modelsummary")
knitr::opts_chunk$set(echo = TRUE)
library(plm)
library(SciViews)
library(stargazer)
library(magrittr)
library(dplyr)
library(fixest)
library(aod)
library(lmtest)
library(modelsummary)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school), model = "random", index = "id", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school) + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), effect = "individual", data=datafull)
msummary(mundlak1)
summary(fixed4)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "individual", data = data)
stargazer(fixed4)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "individual", data = data)
# ```
(vi) Fixed effects estimation may not be as efficient as random effects estimation, but is robust
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "individual", data = data)
#stargazer(fixed4)
summary(fixed4)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "individual", data = data)
stargazer(fixed4)
summary(mundlak1)
summary(fixed4)
summary(mundlak2)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school), model = "random", index = "id", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school), model = "random", index = c("id"), effect = "individual", data=datafull)
summary(mundlak1)
stargazer(mundlak2)
stargazer(fixed4)
summary(mundlak1)
summary(fixed4)
sigma = vcov(mundlak1)
b = coef(mundlak1)
#wald.test(b, sigma, Terms = c(10:16))
waldtest(mundlak1, c(9:16))
waldtest(mundlak2, c(9:16))
# random1 <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw + regs, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random3 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- coeftest(x = random4, vcov = vcovHC(random4, type = "HC0", method = "arellano"))
stargazer(random4)
# random1 <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw + regs, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random3 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
coeftest(random4, vcov = vcovHC(random4, cluster="id"))
# random1 <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw + regs, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random3 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
coeftest(random4, vcov = vcovHC(random4, cluster="group"))
stargazer(random4)
# random1 <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw + regs, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random3 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
try <- coeftest(random4, vcov = vcovHC(random4, cluster="group"))
# stargazer(random4)
phtest(fixed4, try)
phtest(fixed4, random4, vcov = vcovHC(c(fixed4,random4), cluster="group"))
phtest(fixed4, random4)
phtest(fixed4, random4, vcov = vcovHC(c(fixed4,random4), cluster="group"))
phtest(fixed4, random4)
phtest(fixed4, random4, vcov = vcovHC(c(fixed4,random4), cluster="group"))
phtest(fixed4, random4)
phtest(fixed4, random4, vcov = vcovHC(c(fixed4,random4), cluster="group"))
phtest(fixed4, random4, method = "aux", vcov = vcovHC(c(fixed4,random4), cluster="group"))
phtest(fixed4, random4)
from <- lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc
wi <- plm(form, data = data, model = "within")
form <- lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc
wi <- plm(form, data = data, model = "within")
re <- plm(form, data = data, model = "random")
phtest(wi, re)
phtest(form, data = data)
phtest(form, data = data, method = "aux", vcov = vcovHC)
phtest(fixed4, random4)
form <- lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc
wi <- plm(form, data = data, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = data, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = data)
phtest(form, data = data, method = "aux", vcov = vcovHC)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# coeftest(fixed4, vcov = vcovHC(fixed4, cluster="group"))
# stargazer(fixed4)
# random1 <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw + regs, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random3 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# try <- coeftest(random4, vcov = vcovHC(random4, cluster="group"))
# stargazer(random4)
phtest(fixed4, random4)
# random1 <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw + regs, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random3 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
coeftest(random4, vcov = vcovHC(random4, cluster="group"))
# stargazer(random4)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
coeftest(fixed4, vcov = vcovHC(fixed4, cluster="group"))
# stargazer(fixed4)
phtest(fixed4, random4)
phtest(fixed4, random4)
phtest(fixed4, random4)
phtest(fixed4, random4, method = "aux", vcov = vcovHC(c(fixed4,random4), cluster="group"))
form <- lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc
wi <- plm(form, data = data, model = "within")
re <- plm(form, data = data, model = "random")
phtest(wi, re)
phtest(form, data = data)
phtest(form, data = data, method = "aux", vcov = vcovHC)
phtest(fixed4, random4, method = "aux", method = "aux", vcov = vcovHC)
form <- lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc
wi <- plm(form, data = data, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = data, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = data)
phtest(form, data = data, method = "aux", vcov = vcovHC)
phtest(fixed4, random4, method = "aux", method = "aux", vcov = vcovHC)
phtest(fixed4, random4, method = "aux", method = "aux", vcov = vcovHC)
# random1 <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw + regs, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random2 <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
# random3 <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + regs + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
random4 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
coeftest(random4, vcov = vcovHC(random4, cluster="group"))
# stargazer(random4)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
coeftest(fixed4, vcov = vcovHC(fixed4, cluster="group"))
# stargazer(fixed4)
phtest(fixed4, random4, method = "aux", method = "aux", vcov = vcovHC)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
coeftest(fixed4, vcov = vcovHC(fixed4, cluster="group"))
# stargazer(fixed4)
phtest(fixed4, random4)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# coeftest(fixed4, vcov = vcovHC(fixed4, cluster="group"))
# stargazer(fixed4)
phtest(fixed4, random4)
# fixed1  <- plm(lnearnings ~ school + age + agesq  + urban + regne + regnc + regw, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed2  <- plm(lnearnings ~ school + age + agesq + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
# fixed3  <- plm(lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
fixed4  <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = data)
coeftest(fixed4, vcov = vcovHC(fixed4, cluster="group"))
# stargazer(fixed4)
summary(fixed4)
form <- lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc
wi <- plm(form, data = data, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = data, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = data, index = c("id", "time"), effect = "twoways")
phtest(form, data = data, method = "aux", vcov = vcovHC)
form <- lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc
#vcov = vcovHC(fixed4, cluster="group")
wi <- plm(form, data = data, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = data, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = data, index = c("id", "time"), effect = "twoways")
phtest(form, data = data, index = c("id", "time"), effect = "twoways", method = "aux", vcov = vcovHC)
form <- lnearnings ~ school + age + agesq + ethblack + urban + regne + regnc + regw + asvabc
#vcov = vcovHC(fixed4, cluster="group")
wi <- plm(form, data = data, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = data, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = data, index = c("id", "time"), effect = "twoways")
phtest(form, data = data, index = c("id", "time"), effect = "twoways", method = "aux", vcov = vcovHC)
form <- lnearnings ~ school + age + agesq + ethblack +  I(ethblack*school) + urban + regne + regnc + regw + asvabc
#vcov = vcovHC(fixed4, cluster="group")
wi <- plm(form, data = data, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = data, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = data, index = c("id", "time"), effect = "twoways")
phtest(form, data = data, index = c("id", "time"), effect = "twoways", method = "aux", vcov = vcovHC)
interaction <- I(data$ethblack*data$school)
datatry <- cbind(data, interaction)
form <- lnearnings ~ school + age + agesq + ethblack +  interaction + urban + regne + regnc + regw + asvabc
#vcov = vcovHC(fixed4, cluster="group")
wi <- plm(form, data = datatry, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = datatry, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = datatry, index = c("id", "time"), effect = "twoways")
phtest(form, data = datatry, index = c("id", "time"), effect = "twoways", method = "aux", vcov = vcovHC)
interaction <- data$ethblack*data$school
datatry <- cbind(data, interaction)
form <- lnearnings ~ school + age + agesq + ethblack +  interaction + urban + regne + regnc + regw + asvabc
#vcov = vcovHC(fixed4, cluster="group")
wi <- plm(form, data = datatry, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = datatry, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = datatry, index = c("id", "time"), effect = "twoways")
phtest(form, data = datatry, index = c("id", "time"), effect = "twoways", method = "aux", vcov = vcovHC)
View(datatry)
colnames(datatry)
interaction <- data$ethblack*data$school
datatry <- cbind(data, interaction)
View(datatry)
bla <- data$ethblack*data$school
datatry <- cbind(data, bla)
datatry <- data
datatry[interaction] <- data$ethblack*data$school
datatry <- data
datatry$interaction <- data$ethblack*data$school
datatry <- data
datatry$interaction <- data$ethblack*data$school
form <- lnearnings ~ school + age + agesq + ethblack +  interaction + urban + regne + regnc + regw + asvabc
#vcov = vcovHC(fixed4, cluster="group")
wi <- plm(form, data = datatry, model = "within", index = c("id", "time"), effect = "twoways")
re <- plm(form, data = datatry, model = "random", index = c("id", "time"), effect = "twoways")
phtest(wi, re)
phtest(form, data = datatry, index = c("id", "time"), effect = "twoways")
phtest(form, data = datatry, index = c("id", "time"), effect = "twoways", method = "aux", vcov = vcovHC)
phtest(fixed4, random4)
form <- lnearnings ~ school + age + agesq + ethblack +  interaction + urban + regne + regnc + regw + asvabc
#vcov = vcovHC(fixed4, cluster="group")
phtest(fixed4, random4)
phtest(form, data = datatry, index = c("id", "time"), effect = "twoways")
phtest(form, data = datatry, index = c("id", "time"), effect = "twoways", method = "aux", vcov = vcovHC)
data$interaction <- data$ethblack*data$school
View(data)
form <- lnearnings ~ school + age + agesq + ethblack +  interaction + urban + regne + regnc + regw + asvabc
#vcov = vcovHC(fixed4, cluster="group")
phtest(fixed4, random4)
phtest(form, data = data, index = c("id", "time"), effect = "twoways")
phtest(form, data = data, index = c("id", "time"), effect = "twoways", method = "aux", vcov = vcovHC)
mundlak2 <- plm(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school), model = "random", index = "id", data=data)
#mundlak2 <- feols(lnearnings ~ school + age + agesq + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak3 <- plm(lnearnings ~ school + age + agesq + ethblack + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
#mundlak4 <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + asvabc + mean_school + mean_age + mean_agesq + mean_asvabc, model = "random", index = c("id", "time"), effect = "twoways", data=data)
datafull <- na.omit(data)
mundlak1 <- pggls(lnearnings ~ school + age + agesq + ethblack + I(ethblack  * school) + urban + regne + regnc + regw + asvabc + mean_school+ mean_age + mean_agesq + I(ethblack*mean_school) + mean_urban + mean_regne + mean_regnc + mean_regw, model = "random", index = c("id"), effect = "individual", data=datafull)
summary(mundlak1)
stargazer(mundlak2)
stargazer(fixed4)
fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
data <- data %>% group_by(id) %>%
mutate(dummy = ifelse(length(id) > 5, 1, 0))
fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
phtest(fixedbalanced, fixed4)
form <- lnearnings ~ school + age + agesq + ethblack +  interaction + urban + regne + regnc + regw + asvabc
phtest(fixed4, random4)
phtest(form, data = c(data, subset(data, dummy==1))), index = c("id", "time"), effect = "twoways")
#fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
fixedbalanced_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id^time, data = subset(data, dummy==1))
#fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
fixedbalanced_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = subset(data, dummy==1))
fixed_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id^time, data = data)
#fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
fixedbalanced_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = subset(data, dummy==1))
fixed_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = data)
phtest(fixedbalanced_clustered, fixed_clustered)
fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
coeftest(fixed4, vcov = vcovHC(fixed4, cluster="group"))
coeftest(fixedbalanced, vcov = vcovHC(fixedbalanced, cluster="group"))
#fixedbalanced_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = subset(data, dummy==1))
#fixed_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = data)
#phtest(fixedbalanced_clustered, fixed_clustered)
fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
robustunbalanced <- coeftest(fixed4, vcov = vcovHC(fixed4, cluster="group"))
robustbalanced <- coeftest(fixedbalanced, vcov = vcovHC(fixedbalanced, cluster="group"))
#fixedbalanced_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = subset(data, dummy==1))
#fixed_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = data)
#phtest(fixedbalanced_clustered, fixed_clustered)
robustbalanced
View(fixed4)
vcovHCfixed4)
vcovHC(fixed4)
vcovHC(fixedbalanced, cluster="group")
fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
fixed4$vcov <- vcovHC(fixed4, cluster="group")
fixedbalanced$vcov <- vcovHC(fixedbalanced, cluster="group")
#fixedbalanced_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = subset(data, dummy==1))
#fixed_clustered <- feols(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc| id, data = data)
#phtest(fixedbalanced_clustered, fixed_clustered)
fixedbalanced  <- plm(lnearnings ~ school + age + agesq + ethblack + ethblack  * school + urban + regne + regnc + regw + asvabc, model = "within", index = c("id", "time"), effect = "twoways", data = subset(data, dummy==1))
fixed4$vcov <- vcovHC(fixed4, cluster="group")
fixedbalanced$vcov <- vcovHC(fixedbalanced, cluster="group")
phtest(fixed4, fixedbalanced)
